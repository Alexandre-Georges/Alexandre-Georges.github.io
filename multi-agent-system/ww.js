(()=>{"use strict";let t=!1,e=100;const d=o=>{o(),!0===t&&setTimeout((()=>d(o)),e)},o=()=>e,a=()=>{t=!1},r={},i=({height:t,width:e,isWrapAround:d,aliveOdds:o})=>{r.height=t,r.width=e,r.isWrapAround=d,r.aliveOdds=o,r.board=[];for(let d=0;d<t;d++){r.board[d]=[];for(let t=0;t<e;t++)r.board[d][t]=!1}},s=(t,e,d,o,a,r)=>{let i=a,s=r;if(a<0||a>=e){if(!d)return!1;i=a<0?e-1:0}if(r<0||r>=t){if(!d)return!1;s=r<0?t-1:0}return o[s][i]},l=(t,e,d,o,a,r)=>{const i=((t,e,d,o,a,r)=>{let i=0;const l=[{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1}];for(const n of l)s(t,e,d,o,a+n.dx,r+n.dy)&&i++;return i})(t,e,d,o,a,r);return!0===o[r][a]?!(i<2||i>3):3===i},n=()=>{r.board=(({height:t,width:e,aliveOdds:d})=>{const o=[];for(let a=0;a<t;a++){o[a]=[];for(let t=0;t<e;t++)o[a][t]=Math.random()<d}return o})(r)};i({height:50,width:100,isWrapAround:!0,aliveOdds:.05,board:null}),n();let u=()=>"GAME_OF_LIFE",g=()=>"Game Of Life",p=()=>({height:r.height,width:r.width,isWrapAround:r.isWrapAround,aliveOdds:r.aliveOdds}),h=i,f=n,y=(t,e)=>((t,e,d)=>{t[d][e]=!t[d][e]})(r.board,t,e),A=()=>{r.board=(({height:t,width:e,isWrapAround:d,board:o})=>{const a=[];for(let r=0;r<t;r++){a[r]=[];for(let i=0;i<e;i++)a[r][i]=l(t,e,d,o,i,r)}return a})(r)},c=()=>(({height:t,width:e,board:d})=>{const o=[];for(let a=0;a<t;a++)for(let t=0;t<e;t++)!0===d[a][t]&&o.push({x:t,y:a,colour:"black"});return o})(r);const T={getAll:()=>({gameCode:u(),gameName:g(),config:p(),board:c()}),updateConfig:t=>h(t),initBoard:()=>f(),clickOnCell:(t,e)=>y(t,e),goToNextTurn:()=>A(),getColouredBoard:()=>c()},E=t=>{t.goToNextTurn(),postMessage({type:"BOARD_UPDATE",board:t.getColouredBoard()})};onmessage=r=>{if("GET_ALL"===r.data.type){const t=T.getAll();t.timeout=o(),postMessage({type:"SET_ALL",all:t})}else if("NEXT_TURN"===r.data.type)t=!1,d((()=>E(T)));else if("RUN"===r.data.type)(e=>{t=!0,d(e)})((()=>E(T)));else if("PAUSE"===r.data.type)a();else if("UPDATE_CONFIG"===r.data.type){a(),T.updateConfig(r.data.config),T.initBoard();const t=T.getAll();t.timeout=o(),postMessage({type:"SET_ALL",all:t})}else"TIMEOUT_UPDATE"===r.data.type?(i=r.data.timeout,e=i):"RESET"===r.data.type?(T.initBoard(),postMessage({type:"BOARD_UPDATE",board:T.getColouredBoard()})):"CELL_CLICK"===r.data.type&&(T.clickOnCell(r.data.x,r.data.y),postMessage({type:"BOARD_UPDATE",board:T.getColouredBoard()}));var i}})();